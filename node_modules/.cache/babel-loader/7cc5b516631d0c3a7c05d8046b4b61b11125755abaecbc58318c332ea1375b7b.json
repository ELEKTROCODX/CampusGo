{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect, useRef, useState } from \"react\";\nimport jsQR from \"jsqr\";\nexport function useQRScanner(onScan) {\n  _s();\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  const streamRef = useRef(null);\n  const scanningRef = useRef(false);\n  const [scanning, setScanning] = useState(false);\n  useEffect(() => {\n    return () => stopCamera();\n  }, []);\n  async function startCamera() {\n    try {\n      const newStream = await navigator.mediaDevices.getUserMedia({\n        video: {\n          facingMode: {\n            ideal: \"environment\"\n          }\n        }\n      });\n      streamRef.current = newStream;\n      if (videoRef.current) {\n        videoRef.current.srcObject = newStream;\n        await videoRef.current.play();\n      }\n      setScanning(true);\n      scanningRef.current = true;\n      tick();\n    } catch (err) {\n      alert(\"Error accediendo a la cámara: \" + err.message);\n    }\n  }\n  function stopCamera() {\n    setScanning(false);\n    scanningRef.current = false;\n    if (streamRef.current) {\n      streamRef.current.getTracks().forEach(t => t.stop());\n      streamRef.current = null;\n    }\n  }\n  function tick() {\n    if (!scanningRef.current || !videoRef.current || !canvasRef.current) return;\n    const video = videoRef.current;\n    const canvas = canvasRef.current;\n    const ctx = canvas.getContext(\"2d\");\n    if (video.readyState === video.HAVE_ENOUGH_DATA) {\n      canvas.width = video.videoWidth;\n      canvas.height = video.videoHeight;\n      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\n      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n      const code = jsQR(imageData.data, imageData.width, imageData.height);\n      if (code !== null && code !== void 0 && code.data) {\n        console.log(\"QR Code detected:\", code.data.trim());\n        onScan(code.data.trim());\n        stopCamera();\n        return;\n      }\n    }\n    requestAnimationFrame(tick);\n  }\n  return {\n    videoRef,\n    canvasRef,\n    startCamera,\n    stopCamera,\n    scanning\n  };\n}\n_s(useQRScanner, \"4N3YbQKDU3Bniv1b3l3nMRLbCz0=\");","map":{"version":3,"names":["useEffect","useRef","useState","jsQR","useQRScanner","onScan","_s","videoRef","canvasRef","streamRef","scanningRef","scanning","setScanning","stopCamera","startCamera","newStream","navigator","mediaDevices","getUserMedia","video","facingMode","ideal","current","srcObject","play","tick","err","alert","message","getTracks","forEach","t","stop","canvas","ctx","getContext","readyState","HAVE_ENOUGH_DATA","width","videoWidth","height","videoHeight","drawImage","imageData","getImageData","code","data","console","log","trim","requestAnimationFrame"],"sources":["C:/Users/diego/OneDrive/Escritorio/CampusGo/src/hooks/useQRScanner.js"],"sourcesContent":["import { useEffect, useRef, useState } from \"react\";\r\nimport jsQR from \"jsqr\";\r\n\r\nexport function useQRScanner(onScan) {\r\n  const videoRef = useRef(null);\r\n  const canvasRef = useRef(null);\r\n  const streamRef = useRef(null);\r\n  const scanningRef = useRef(false);\r\n  const [scanning, setScanning] = useState(false);\r\n\r\n  useEffect(() => {\r\n    return () => stopCamera();\r\n  }, []);\r\n\r\n  async function startCamera() {\r\n    try {\r\n      const newStream = await navigator.mediaDevices.getUserMedia({\r\n        video: { facingMode: { ideal: \"environment\" } },\r\n      });\r\n      streamRef.current = newStream;\r\n      if (videoRef.current) {\r\n        videoRef.current.srcObject = newStream;\r\n        await videoRef.current.play();\r\n      }\r\n      setScanning(true);\r\n      scanningRef.current = true;      \r\n      tick();\r\n    } catch (err) {\r\n      alert(\"Error accediendo a la cámara: \" + err.message);\r\n    }\r\n  }\r\n\r\n  function stopCamera() {\r\n    setScanning(false);\r\n    scanningRef.current = false;\r\n    if (streamRef.current) {\r\n      streamRef.current.getTracks().forEach((t) => t.stop());\r\n      streamRef.current = null;\r\n    }\r\n  }\r\n\r\n  function tick() {\r\n    if (!scanningRef.current || !videoRef.current || !canvasRef.current) return;\r\n\r\n    const video = videoRef.current;\r\n    const canvas = canvasRef.current;\r\n    const ctx = canvas.getContext(\"2d\");\r\n    \r\n    if (video.readyState === video.HAVE_ENOUGH_DATA) {\r\n      canvas.width = video.videoWidth;\r\n      canvas.height = video.videoHeight;\r\n      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n\r\n      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n      const code = jsQR(imageData.data, imageData.width, imageData.height);\r\n      \r\n      if (code?.data) {\r\n        console.log(\"QR Code detected:\", code.data.trim());\r\n        \r\n        onScan(code.data.trim());\r\n        stopCamera();\r\n        return;\r\n      }\r\n    }\r\n    requestAnimationFrame(tick);\r\n  }\r\n\r\n  return { videoRef, canvasRef, startCamera, stopCamera, scanning };\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}